I"­f<p><img src="https://velog.velcdn.com/images/-__-/post/beb1cc2e-771d-4b36-b0c6-6a5dd7740082/image.png" alt="" /></p>

<p>â­ í•˜ì´í¼ë ˆì € íŒ¨ë¸Œë¦­ 2.2 ver ê¸°ì¤€</p>

<blockquote>
  <p><strong>â€˜ë””ì•±â€™</strong> ì€ ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” <strong>íŠ¹ì • ì²´ì¸ì½”ë“œì˜ íŠ¹ì • ê¸°ëŠ¥</strong>ì„ ìš”ì²­í•´ì„œ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ë¥¼ ë°›ëŠ”ê²ƒì´ <span style="background-color:#B5E045; color:#000;">ë””ì•±ì˜ ëª©ì ì´ë‹¤</span></p>
</blockquote>

<ol>
  <li>
    <p>ë””ì•±ì€ ìš”ì²­í•˜ê¸° ì „ì— ë””ì•±ì€ <strong>â€˜ì¸ì¦ì„œâ€™</strong> ë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼í•œë‹¤
ğŸ‘‰ ê·¸ë˜ì•¼ ë¡œê·¸ì¸ì„ í• ìˆ˜ìˆë‹¤</p>
  </li>
  <li>
    <p>ë””ì•±ì€ <strong>â€˜CA (Certificate Authority)â€™</strong> ì— ì¸ì¦ì„œë¥¼ ìš”ì²­í•´ì„œ <strong>ì¸ì¦ì„œ</strong>ë¥¼ ë°›ì•„ì™€ì•¼í•œë‹¤</p>
  </li>
  <li>
    <p><strong>â€˜CAâ€™</strong>ì— ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼í•˜ëŠ”ë°</p>
  </li>
  <li>
    <p>ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‹¤í–‰ ì‹œí‚¤ë©´ <code class="language-plaintext highlighter-rouge">peer / orderer / CA</code> ê¹Œì§€ ê°™ì´ ì¼œì§„ë‹¤</p>
  </li>
  <li>
    <p>ë„¤íŠ¸ì›Œí¬ë¥¼ í‚¤ë©´ ì£¼ì†Œê°€ ê²°ì •ë˜ëŠ”ë° ì´ë•Œ ë‹¤ê°™ì´ ìƒì„±ëœ
<code class="language-plaintext highlighter-rouge">peer / orderer / CA</code> ì£¼ì†Œë¥¼ ëª¨ì•„ì„œ <strong>â€˜cppâ€™</strong> json íŒŒì¼ì„ ë§Œë“ ë‹¤
<span style="background-color:#34CDEF; color:#000;">â­ (ccp = abi ì™€ ë¹„ìŠ·í•¨)</span></p>
  </li>
  <li>
    <p>ë””ì•±ì€ <strong>â€˜ccpâ€™</strong> ë¥¼ ì½ì–´ì™€ì„œ <strong>â€˜CAâ€™</strong> ì— ì ‘ì†í• ìˆ˜ìˆë‹¤ (ì£¼ì†Œë¥¼ ì•„ë‹ˆê¹Œ)</p>
  </li>
  <li>
    <p><strong>â€˜CAâ€™</strong> ì— ì ‘ì†ì„ í•´ì„œ ì¸ì¦ì„œë¥¼ ë°›ì•„ì˜¤ê³ </p>
  </li>
  <li>
    <p>ë°›ì•„ì˜¨ ì¸ì¦ì„œëŠ” <span style="background-color:#BFA8EE; color:#000;">ì§€ê°‘(Wallet) ì— ì €ì¥í•œë‹¤</span></p>
  </li>
  <li>
    <p>ë””ì•±ì€ ì¸ì¦ì„œë¥¼ êº¼ë‚´ì„œ <strong>â€˜ì¸ì¦â€™</strong>ì„ í•¨ê³¼ ë™ì‹œì— / ì²´ì¸ì½”ë“œë¥¼ ìš”ì²­í•˜ê³  <strong>ê²°ê³¼</strong>ë¥¼ ë°›ëŠ”ë‹¤</p>
  </li>
</ol>

<blockquote>
  <p>ì¤€ë¹„ë¬¼ ìƒì„± ğŸ‘‰ ë„¤íŠ¸ì›Œí¬ êµ¬ë™ ğŸ‘‰ ì±„ë„ ì¡°ì¸ ğŸ‘‰ ì•µì»¤í”¼ì–´ ì„¤ì • ğŸ‘‰ ì²´ì¸ì½”ë“œ ì„¤ì¹˜ &amp; ë°°í¬</p>
</blockquote>

<hr />

<h3 id="register--enroll">Register &amp; Enroll</h3>

<blockquote>
  <p>ê´€ë¦¬ìì˜ ì…ì¥ìœ¼ë¡œì„œ ìœ ì €ë¥¼ ë“±ë¡ ğŸ‘‰ Register
â€˜CAâ€™ ì— ê´€ë¦¬ì ê³„ì •ì„ ë“±ë¡í•˜ëŠ” í–‰ìœ„ë¥¼ <strong>â€˜Registerâ€™</strong> ë¼ê³  í•œë‹¤</p>
</blockquote>

<blockquote>
  <p>ìœ ì €ì˜ ì…ì¥ìœ¼ë¡œëŠ” ë°œê¸‰ ğŸ‘‰ enroll
ë“±ë¡ë˜ì–´ìˆëŠ” ì‚¬ìš©ì ì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ì•„ì˜¤ëŠ” í–‰ìœ„ë¥¼ <strong>â€˜Enrollâ€™</strong> ì´ë¼ê³  í•œë‹¤</p>
</blockquote>

<ul>
  <li>
    <p>enrollAdmin ğŸ‘‰ <span style="background-color:#BFA8EE; color:#000;">ê´€ë¦¬ì ì§€ê°‘ ìƒì„±</span> ğŸ‘‰ ì¸ì¦ì„œë°›ê¸°</p>
  </li>
  <li>
    <p>registerUser ğŸ‘‰ <span style="background-color:#B5E045; color:#000;">ì‚¬ìš©ì ì§€ê°‘ ìƒì„±</span> ğŸ‘‰ ì¸ì¦ì„œë°›ê¸°</p>
  </li>
  <li>
    <p>ê´€ë¦¬ìê°€ ì‚¬ìš©ìë¥¼ ë“±ë¡ì‹œí‚¬ë•Œ <span style="background-color:#BFA8EE; color:#000;">ê´€ë¦¬ì ì¸ì¦ì„œë¥¼ í™•ì¸</span></p>
  </li>
  <li>
    <p>ê´€ë¦¬ìê°€ ë³¸ì¸ì˜ ê¶Œí•œìœ¼ë¡œ <strong>ì‚¬ìš©ìë¥¼ ë“±ë¡</strong>í•´ì¤˜ì•¼ ì‚¬ìš©ìê°€ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ìˆ˜ìˆë‹¤</p>
  </li>
  <li>
    <p>ìœ ì € ë“±ë¡ì„ ìœ„í•´ì„œëŠ” <strong>ê´€ë¦¬ì(Admin)</strong> ê¶Œí•œì´ í•„ìš”í•˜ë‹¤</p>
  </li>
  <li>
    <p>ê´€ë¦¬ìì˜ ê¶Œí•œìœ¼ë¡œ <strong>â€˜CAâ€™</strong> ì— ë“±ë¡ ğŸ‘‰ ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰</p>
  </li>
</ul>

<blockquote>
  <p>ë„¤íŠ¸ì›Œí¬ ë™ì‘ ğŸ‘‰ ë„¤íŠ¸ì›Œí¬ì— ë§ëŠ” CCP ìƒì„± ğŸ‘‰ CCPë¥¼ ì´ìš©í•˜ì—¬ CA ì ‘ì† ğŸ‘‰ í•„ìš”í•œ ì¸ì¦ì„œ ë°œê¸‰ ğŸ‘‰ walletì— ì €ì¥ &amp; êº¼ë‚´ì“°ê¸°</p>
</blockquote>

<blockquote>
  <p>â­ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">íšŒì›ê°€ì…, í•¸ë“œí° ì¸ì¦</code> ë“± ê°™ì€ ê³¼ì •ì„ ê±°ì³ì„œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ <strong>(Enroll)</strong></p>
</blockquote>

<blockquote>
  <h3 id="ì˜ˆë¥¼ë“¤ì–´">ì˜ˆë¥¼ë“¤ì–´</h3>

  <p>íšŒì‚¬(CA)ì— <strong>ì²˜ìŒ ì…ì‚¬í–ˆì„ë•Œ</strong> íšŒì‚¬ DBì— ë„£ì„ <br />
ë‚˜ì˜ ê°œì¸ì •ë³´ë¥¼ <span style="background-color:#B5E045; color:#000;">ìµœì´ˆë¡œ ë“±ë¡í•˜ëŠ” ê³¼ì •</span>
ğŸ‘‰ <strong>Register</strong> <br />
íšŒì‚¬(CA)ì— ë‚´ê°€ ì¶œì…ì¹´ë“œë¥¼ ë°œê¸‰ìš”ì²­í•˜ë©´ ì¶œì…ì¹´ë“œë¥¼ ì¤€ë‹¤
íšŒì‚¬ DBì—ëŠ” ë‚˜ì˜ ì •ë³´ê°€ ë“±ë¡ë˜ì–´ìˆì„ ê²ƒì´ë‹¤
ğŸ‘‰ ë“±ë¡ë˜ì–´ìˆëŠ” DBë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¶œì…ì¹´ë“œë¥¼ <span style="background-color:#BFA8EE; color:#000;">ë°œê¸‰í•´ì¤€ë‹¤</span> <strong>(Enroll)</strong>
ì¶œì…ì¹´ë“œë¥¼ ë¶„ì‹¤í–ˆì–´ë„ DBë¥¼ ê¸°ì¤€ìœ¼ë¡œ <span style="background-color:#BFA8EE; color:#000;">ì¬ë°œê¸‰ì´ ê°€ëŠ¥í•˜ë‹¤</span></p>
</blockquote>

<hr />

<h3 id="enrolladmin-ì½”ë“œ">enrollAdmin ì½”ë“œ</h3>

<blockquote>
  <ol>
    <li><strong>â€˜ccpâ€™</strong> ì— ì ‘ê·¼í•´ì„œ CA ì£¼ì†Œë¥¼ ì°¾ëŠ” ì‘ì—…</li>
    <li>ì§€ê°‘ ìœ ë¬´ í™•ì¸ ì²´í¬ (<strong>ê´€ë¦¬ì ê¶Œí•œ</strong> ì²´í¬)</li>
    <li>ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ <strong>ì¸ì¦ì„œ ë°œê¸‰</strong> í›„ ì§€ê°‘ì— ì €ì¥</li>
  </ol>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">FabricCAServices</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fabric-ca-client</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Wallets</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fabric-network</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ccpPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ccp</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">connection-org1.json</span><span class="dl">"</span><span class="p">);</span>
    <span class="c1">// ccp íŒŒì¼ json ì— ì ‘ê·¼ ğŸ‘‰ ì ‘ì†í•  ì£¼ì†Œë¥¼ ì°¾ì•„ì•¼í•¨</span>
    <span class="kd">const</span> <span class="nx">ccp</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">ccpPath</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">));</span>
    <span class="c1">// jsonì„ parse ì‹œí‚¨ë‹¤</span>

    <span class="kd">const</span> <span class="nx">caInfo</span> <span class="o">=</span> <span class="nx">ccp</span><span class="p">.</span><span class="nx">certificateAuthorities</span><span class="p">[</span><span class="dl">"</span><span class="s2">ca.org1.example.com</span><span class="dl">"</span><span class="p">];</span>
    <span class="c1">// json íŒŒì¼ì—ì„œ ì ‘ì†í•  url ì£¼ì†Œë¥¼ ì°¾ìŒ</span>
    <span class="kd">const</span> <span class="nx">caTLSCACerts</span> <span class="o">=</span> <span class="nx">caInfo</span><span class="p">.</span><span class="nx">tlsCACerts</span><span class="p">.</span><span class="nx">pem</span><span class="p">;</span>
    <span class="c1">// ì°¾ì€ url CA ì£¼ì†Œ</span>
    <span class="kd">const</span> <span class="nx">ca</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FabricCAServices</span><span class="p">(</span>
      <span class="nx">caInfo</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
      <span class="p">{</span> <span class="na">trustedRoots</span><span class="p">:</span> <span class="nx">caTLSCACerts</span><span class="p">,</span> <span class="na">verify</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
      <span class="nx">caInfo</span><span class="p">.</span><span class="nx">caName</span>
    <span class="p">);</span>

    <span class="kd">const</span> <span class="nx">walletPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">wallet</span><span class="dl">"</span><span class="p">);</span>
    <span class="c1">// wallet ì—´ê¸° / ì—†ìœ¼ë©´ ìƒì„± / í˜„ì¬ê²½ë¡œì—</span>
    <span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Wallets</span><span class="p">.</span><span class="nx">newFileSystemWallet</span><span class="p">(</span><span class="nx">walletPath</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Wallet path: </span><span class="p">${</span><span class="nx">walletPath</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">identity</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">);</span>
    <span class="c1">// admin ì´ë¼ëŠ” ì¸ì¦ì„œê°€ ìˆëŠ”ì§€ í™•ì¸</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">identity</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="dl">'</span><span class="s1">An identity for the admin user "admin" already exists in the wallet</span><span class="dl">'</span>
      <span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// â­ CAê°€ ì¼œì§ˆë•Œ admin í•˜ë‚˜ëŠ” register ëœ ìƒíƒœë¡œ ì¼œì§„ë‹¤</span>
    <span class="c1">// ìµœì´ˆì˜ ê´€ë¦¬ì</span>
    <span class="kd">const</span> <span class="nx">enrollment</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ca</span><span class="p">.</span><span class="nx">enroll</span><span class="p">({</span>
      <span class="na">enrollmentID</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ìµœì´ˆ ì´ë¯¸ ë“±ë¡ë˜ì–´ìˆëŠ” ê´€ë¦¬ì ì•„ì´ë””</span>
      <span class="na">enrollmentSecret</span><span class="p">:</span> <span class="dl">"</span><span class="s2">adminpw</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</span>
    <span class="p">});</span>
    <span class="kd">const</span> <span class="nx">x509Identity</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">certificate</span><span class="p">:</span> <span class="nx">enrollment</span><span class="p">.</span><span class="nx">certificate</span><span class="p">,</span> <span class="c1">// ê´€ë¦¬ìê¶Œí•œìœ¼ë¡œ ë°œê¸‰</span>
        <span class="na">privateKey</span><span class="p">:</span> <span class="nx">enrollment</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(),</span> <span class="c1">// ê´€ë¦¬ìê¶Œí•œìœ¼ë¡œ ë°œê¸‰</span>
      <span class="p">},</span>
      <span class="na">mspId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Org1MSP</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">X.509</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="k">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x509Identity</span><span class="p">);</span>
    <span class="c1">// ì§€ê°‘ì— ê´€ë¦¬ì ì¸ì¦ì„œê°€ í•œê°œ ë°œê¸‰ë˜ì–´ ì €ì¥(put)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">Successfully enrolled admin user "admin" and imported it into the wallet</span><span class="dl">'</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Failed to enroll admin user "admin": </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</code></pre></div></div>

<hr />

<h3 id="registeruser-ì½”ë“œ">registerUser ì½”ë“œ</h3>

<blockquote>
  <ol>
    <li><strong>â€˜ccpâ€™</strong> ì— ì ‘ê·¼í•´ì„œ CA ì£¼ì†Œë¥¼ ì°¾ëŠ” ì‘ì—…</li>
    <li>ì§€ê°‘ ìœ ë¬´ í™•ì¸ ì²´í¬ (<strong>ê´€ë¦¬ì ê¶Œí•œ</strong> ì²´í¬)</li>
    <li>ê´€ë¦¬ìì˜ ê¶Œí•œìœ¼ë¡œ ìœ ì €ë¥¼ ë“±ë¡</li>
  </ol>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">Wallets</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fabric-network</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">FabricCAServices</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fabric-ca-client</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ccpPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ccp</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">connection-org1.json</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// ccp íŒŒì¼ json ì— ì ‘ê·¼ ğŸ‘‰ ì ‘ì†í•  ì£¼ì†Œë¥¼ ì°¾ì•„ì•¼í•¨</span>
    <span class="kd">const</span> <span class="nx">ccp</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">ccpPath</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">));</span>
    <span class="c1">// jsonì„ parse ì‹œí‚¨ë‹¤</span>

    <span class="kd">const</span> <span class="nx">caURL</span> <span class="o">=</span> <span class="nx">ccp</span><span class="p">.</span><span class="nx">certificateAuthorities</span><span class="p">[</span><span class="dl">"</span><span class="s2">ca.org1.example.com</span><span class="dl">"</span><span class="p">].</span><span class="nx">url</span><span class="p">;</span>
    <span class="c1">// json íŒŒì¼ì—ì„œ ì ‘ì†í•  url ì£¼ì†Œë¥¼ ì°¾ìŒ</span>
    <span class="kd">const</span> <span class="nx">ca</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FabricCAServices</span><span class="p">(</span><span class="nx">caURL</span><span class="p">);</span> <span class="c1">// ì°¾ì€ url CA ì£¼ì†Œ</span>

    <span class="kd">const</span> <span class="nx">walletPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="dl">"</span><span class="s2">wallet</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Wallets</span><span class="p">.</span><span class="nx">newFileSystemWallet</span><span class="p">(</span><span class="nx">walletPath</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Wallet path: </span><span class="p">${</span><span class="nx">walletPath</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">userIdentity</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">appUser</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">userIdentity</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="dl">'</span><span class="s1">An identity for the user "appUser" already exists in the wallet</span><span class="dl">'</span>
      <span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">adminIdentity</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">);</span>
    <span class="c1">// admin(ê´€ë¦¬ì) ê¶Œí•œ ë¶ˆëŸ¬ì˜¤ê¸°</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">adminIdentity</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="dl">'</span><span class="s1">An identity for the admin user "admin" does not exist in the wallet</span><span class="dl">'</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Run the enrollAdmin.js application before retrying</span><span class="dl">"</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">provider</span> <span class="o">=</span> <span class="nx">wallet</span>
      <span class="p">.</span><span class="nx">getProviderRegistry</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">getProvider</span><span class="p">(</span><span class="nx">adminIdentity</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">adminUser</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">provider</span><span class="p">.</span><span class="nx">getUserContext</span><span class="p">(</span><span class="nx">adminIdentity</span><span class="p">,</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// ê´€ë¦¬ìê¶Œí•œ ìƒì„±</span>

    <span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ca</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="na">affiliation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">org1.department1</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ì†Œì†</span>
        <span class="na">enrollmentID</span><span class="p">:</span> <span class="dl">"</span><span class="s2">appUser</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ì•„ì´ë””</span>
        <span class="na">role</span><span class="p">:</span> <span class="dl">"</span><span class="s2">client</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ì—­í• (ê¶Œí•œ)</span>
      <span class="p">},</span> <span class="c1">// admin / peer / client 3ê°œì¤‘ í•˜ë‚˜</span>
      <span class="nx">adminUser</span> <span class="c1">// ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ User ë“±ë¡</span>
    <span class="p">);</span>
    <span class="c1">//------------ admin (ê´€ë¦¬ì)ì˜ ì—­í•  ë</span>
    <span class="c1">//------------ dapp ì—ì„œ ì¡°ì‘í•´ì•¼í•  ì˜ì—­ ğŸ‘‡ğŸ‘‡</span>
    <span class="kd">const</span> <span class="nx">enrollment</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ca</span><span class="p">.</span><span class="nx">enroll</span><span class="p">({</span>
      <span class="na">enrollmentID</span><span class="p">:</span> <span class="dl">"</span><span class="s2">appUser</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">enrollmentSecret</span><span class="p">:</span> <span class="nx">secret</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="kd">const</span> <span class="nx">x509Identity</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">certificate</span><span class="p">:</span> <span class="nx">enrollment</span><span class="p">.</span><span class="nx">certificate</span><span class="p">,</span>
        <span class="na">privateKey</span><span class="p">:</span> <span class="nx">enrollment</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(),</span>
      <span class="p">},</span>
      <span class="na">mspId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Org1MSP</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">X.509</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="k">await</span> <span class="nx">wallet</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">appUser</span><span class="dl">"</span><span class="p">,</span> <span class="nx">x509Identity</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">Successfully registered and enrolled admin user "appUser" and imported it into the wallet</span><span class="dl">'</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Failed to register user "appUser": </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</code></pre></div></div>

<hr />
:ET