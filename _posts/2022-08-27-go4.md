---
layout: post
title: "[Go lang] ì²´ì¸ì½”ë“œ ë°°í¬ & íŠ¸ëœì­ì…˜ ë°œìƒ, í™•ì¸ / couchdb"
subtitle: chaincode/ docker / invoke / query / fabric-couchdb
categories: Go
tags: [ê³ ì–¸ì–´]
---

![](https://velog.velcdn.com/images/-__-/post/37f16109-4964-4468-bc63-bb7315243de8/image.png)

â­ í•˜ì´í¼ë ˆì € íŒ¨ë¸Œë¦­ 1.4 ver ê¸°ì¤€

## ì²´ì¸ì½”ë“œ ë°°í¬ (ê´€ë¦¬ìì˜ ê´€ì )

### ë°°í¬ ëª…ë ¹ì–´ ìˆœì„œ

> - docker-compose -f docker-compose.yml up -d cli<br>
>
> - docker exec cli peer chaincode install -n fabcar -v 1.0 -p github.com/fabcar/go<br>
>
> - docker exec cli peer chaincode instantiate -o orderer.example.com:7050 -n fabcar -v 1.0 -c '{"Args":[]}' -C mychannel -P "OR ('Org1MSP.member','Org2MSP.member')"<br>
>
> - docker exec cli peer chaincode invoke -o orderer.example.com:7050 -n fabcar -c '{"Args":["initLedger"]}' -C mychannel<br>
>
> - docker exec cli peer chaincode query -n fabcar -c '{"Args":["queryAllCars"]}' -C mychannel<br>
>
> - docker exec cli peer chaincode invoke -o orderer.example.com:7050 -n fabcar -c '{"Args":["createCar","CAR12","sm","sm3","red","shin"]}' -C mychannel<br>
>
> - docker exec cli peer chaincode query -n fabcar -c '{"Args":["queryCar","CAR12"]}' -C mychannel<br>

-1. `docker-compose -f docker-compose.yml up -d cli`<br>
ğŸ‘‰ `-d` ì˜µì…˜ì„ ì•ˆì£¼ë©´ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê³  ë¬´í•œë£¨í”„ì— ê°‡íŒë‹¤<br>
ğŸ‘‰ `cli` ë¼ëŠ” ì»¨í…Œì´ë„ˆ ìƒì„±

---

-2. `cli` ì»¨í…Œì´ë„ˆëŠ” í•˜ì´í¼ë ˆì € ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ì½˜ì†” ì—­í•  (peer ì—ê²Œ ëª…ë ¹ì„ ì£¼ëŠ” ê´€ë¦¬ì)

![](https://velog.velcdn.com/images/-__-/post/d61b7887-1006-444c-8409-ce91b330343c/image.png)

> ğŸ‘† cli ì»¨í…Œì´ë„ˆ ì„¤ì • (ê´€ë¦¬ììš© ì½˜ì†”)<br>
>
> ### environment (í™˜ê²½ë³€ìˆ˜)
>
> 1.  ì²´ì¸ì½”ë“œì— ëŒ€í•œ ì„¤ì¹˜ ë°°í¬ëª…ë ¹ `GOPATH í™˜ê²½ë³€ìˆ˜`
> 2.  ì—°ê²°í•  peer ì˜ ì •ë³´ (ì»¨í…Œì´ë„ˆ ì´ë¦„ or IPì£¼ì†Œ or ë„ë©”ì¸ì£¼ì†Œ ë“±)
> 3.  ì»¨í…Œì´ë„ˆì™€ í†µì‹ í•˜ëŠ”ë° í•„ìš”í•œ PORT ë²ˆí˜¸
> 4.  ì–´ë–¤ ë©¤ë²„ì‹­ìœ¼ë¡œ ì—°ê²°ì„ í• ì§€ (ì¡°ì§ë©¤ë²„ì‹­)
> 5.  ì–´ë–¤ ê¶Œí•œìœ¼ë¡œ peer ì—ê²Œ ì ‘ê·¼í• ì§€ (ë©¤ë²„ì‹­ ê²½ë¡œ)
> 6.  ì–´ë–¤ ê¶Œí•œìœ¼ë¡œ peer ì—ê²Œ íŠ¸ëœì­ì…˜ì„ ì¼ìœ¼í‚¬ê²ƒì¸ì§€<br>
>     (**í‚¤ì™€ ì¸ì¦ì„œ**ë¥¼ ì´ìš©í•˜ì—¬ ê¶Œí•œ íšë“)<br>
>
> ### volumes
>
> 1.  ë¦¬ëˆ…ìŠ¤ â†’ ë„ì»¤ â†’ ì´ë¯¸ì§€ â†’ ì»¨í…Œì´ë„ˆ ìƒì„±
> 2.  ì»¨í…Œì´ë„ˆë“¤ì´ ì‚¬ìš©í•  ì„¸ë¶€ì ì¸ ì„¤ì •ë‚´ìš© / íŒŒì¼ì€ ì´ë¯¸ì§€ì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤
> 3.  ì´ëŸ° ê²½ìš°ì—ëŠ” ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì— ìˆëŠ” ë””ë ‰í† ë¦¬ì—ì„œ **ì„¸ë¶€ê°’**ì„ ê°€ì ¸ì˜¨ë‹¤

> `/var/run/ : /host/var/run/`<br>
> **' : ' ë¥¼ ê¸°ì¤€ìœ¼ë¡œ** <br>
> ì•ì—ëŠ” ë¦¬ëˆ…ìŠ¤ ë””ë ‰í† ë¦¬ ê²½ë¡œ <br>
> ë’¤ì—ëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆ ì €ì¥ ê²½ë¡œ

---

-3. `docker exec cli peer chaincode install -n fabcar -v 1.0 -p github.com/fabcar/go`

- ë„ì»¤ clië¡œ **(ê´€ë¦¬ìê¶Œí•œ)** ëª…ë ¹ì–´ ì‹¤í–‰
- `peer chaincode install` ì²´ì¸ì½”ë“œ ì„¤ì¹˜
- ì²´ì¸ì½”ë“œì˜ ì´ë¦„ì€ `fabcar`
- ë²„ì „ê´€ë¦¬ë¥¼ ìœ„í•´ ë²„ì „ì •ë³´ `v 1.0`
- ì²´ì¸ì½”ë“œê°€ ì–´ë–¤ ë””ë ‰í† ë¦¬ì— ìˆëŠ”ì§€ ì§€ì • `-p github.com/fabcar/go`

![](https://velog.velcdn.com/images/-__-/post/ea19b480-746c-4631-b52c-1bb1313010cb/image.png)

> `docker exec cli peer chaincode list --installed`<br>
> ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸ ğŸ‘†

---

-4. `docker exec cli peer chaincode instantiate -o orderer.example.com:7050 -n fabcar -v 1.0 -c '{"Args":[]}' -C mychannel -P "OR ('Org1MSP.member','Org2MSP.member')"`

- ë„ì»¤ clië¡œ **(ê´€ë¦¬ìê¶Œí•œ)** ëª…ë ¹ì–´ ì‹¤í–‰
- `peer chaincode instantiate` ì²´ì¸ì½”ë“œ ë°°í¬
- ì²´ì¸ì½”ë“œ ë°°í¬ëŠ” **ì±„ë„ ì „ì²´**ì— ì˜í–¥ì„ ì¤€ë‹¤ â­
- ì²´ì¸ì½”ë“œ <span style="background-color:#B5E045; color:#000;">'ì„¤ì¹˜'</span>ëŠ” peer ë§ˆë‹¤ í•´ì¤˜ì•¼í•˜ì§€ë§Œ <span style="background-color:#B5E045; color:#000;">'ë°°í¬'</span>ëŠ” ì±„ë„ì— í•œë²ˆë§Œ í•´ì£¼ë©´ ëœë‹¤
- `-o orderer.example.com:7050` ë°°í¬ê°€ ë˜ë©´ orderer ë¡œ ì „ë‹¬ì´ ë˜ì–´ì•¼ í•œë‹¤
- ì–´ë–¤ ì²´ì¸ì½”ë“œë¥¼ ë°°í¬í• ì§€ ì´ë¦„ `-n fabcar`
- ë²„ì „ê´€ë¦¬ë¥¼ ìœ„í•´ ë²„ì „ì •ë³´ `v 1.0`
- `-c '{"Args":[]}'` ì²´ì¸ì½”ë“œì— **'Init' í•¨ìˆ˜** ì›ì¥ì˜ ì´ˆê¸°ê°’ ì„¤ì • (key-value ê°’)
- `-C mychannel` ë°°í¬ ë  ì±„ë„ ì´ë¦„
- `-P "OR ('Org1MSP.member','Org2MSP.member')"`<br>
  ğŸ‘‰ `-P`ëŠ” ì •ì±…, ordererì— ì´ ë‚´ìš©ì´ ë“¤ì–´ê°„ë‹¤<br>
  ğŸ‘‰ "OR" **ì–´ë–¤ ì¡°ì§**ì´ë¼ë„ íŠ¸ëœì­ì…˜ì„ ìŠ¹ì¸í•˜ë©´ ë¸”ë¡í™” ì‹œí‚¨ë‹¤<br>
  ğŸ‘‰ "AND" **ë‘ ì¡°ì§ ëª¨ë‘** íŠ¸ëœì­ì…˜ì„ ìŠ¹ì¸í•˜ë©´ ë¸”ë¡í™” ì‹œí‚¨ë‹¤

![](https://velog.velcdn.com/images/-__-/post/df43d543-d98b-4597-9f06-c1d025b50bbc/image.png)

> `docker exec cli peer chaincode list --instantiated -C mychannel`<br>
> ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸ ğŸ‘†<br>
>
> - ì²´ì¸ì½”ë“œ ì´ë¦„ / ë²„ì „ / ê²½ë¡œ

---

-5. `docker exec cli peer chaincode invoke -o orderer.example.com:7050 -n fabcar -c '{"Args":["initLedger"]}' -C mychannel`

- ë„ì»¤ clië¡œ **(ê´€ë¦¬ìê¶Œí•œ)** ëª…ë ¹ì–´ ì‹¤í–‰
- `peer chaincode invoke` ì²´ì¸ì½”ë“œë¡œ íŠ¸ëœì­ì…˜ì„ ë°œìƒì‹œí‚¨ë‹¤
- `-o orderer.example.com:7050` íŠ¸ëœì­ì…˜ì´ ë°œìƒí•˜ë©´ ë¸”ë¡ì´ ìƒì„±ë˜ëŠ”ë° ë¸”ë¡ì´ ìƒì„±ì´ë˜ë ¤ë©´ 'orderer' ì˜ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤
- ì–´ë–¤ ì²´ì¸ì½”ë“œë¥¼ ë™ì‘ì‹œí‚¬ì§€ `-n fabcar`
- `-c '{"Args":["initLedger"]}'` ì–´ë–¤ íŠ¸ë™ì­ì…˜ì„ ë°œìƒì‹œí‚¬ì§€ ë‚´ìš©ê°’
- ì–´ë–¤ ì±„ë„ì— ìˆëŠ”ì§€ `-C mychannel`

![](https://velog.velcdn.com/images/-__-/post/eb69abdc-731a-409a-bbcd-697066681ebf/image.png)

> `docker exec cli peer chaincode query -n fabcar -c '{"Args":["queryAllCars"]}' -C mychannel`<br>
> ì„±ê³µì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸ ğŸ‘†<br>
>
> - `peer chaincode query` íŠ¸ëœì­ì…˜ ë‚´ìš© ì „ë‹¬ (í™•ì¸)

---

-6. `docker exec cli peer chaincode invoke -o orderer.example.com:7050 -n fabcar -c '{"Args":["createCar","CAR12","sm","sm3","red","shin"]}' -C mychannel`

- ë„ì»¤ clië¡œ **(ê´€ë¦¬ìê¶Œí•œ)** ëª…ë ¹ì–´ ì‹¤í–‰
- `peer chaincode invoke` ì²´ì¸ì½”ë“œë¡œ íŠ¸ëœì­ì…˜ì„ ë°œìƒì‹œí‚¨ë‹¤
- `-o orderer.example.com:7050` íŠ¸ëœì­ì…˜ì´ ë°œìƒí•˜ë©´ ë¸”ë¡ì´ ìƒì„±ë˜ëŠ”ë° ë¸”ë¡ì´ ìƒì„±ì´ë˜ë ¤ë©´ ordererì˜ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤
- ì–´ë–¤ ì²´ì¸ì½”ë“œë¥¼ ë™ì‘ì‹œí‚¬ì§€ `-n fabcar`
- `-c '{"Args":["createCar","CAR12","sm","sm3","red","shin"]}'` ì–´ë–¤ íŠ¸ë™ì­ì…˜ì„ ë°œìƒì‹œí‚¬ì§€ ë‚´ìš©ê°’
- ì–´ë–¤ ì±„ë„ì— ìˆëŠ”ì§€ `-C mychannel`

![](https://velog.velcdn.com/images/-__-/post/d976907a-7975-4866-a189-c097d8d14a63/image.png)

> `docker exec cli peer chaincode query -n fabcar -c '{"Args":["queryCar","CAR12"]}' -C mychannel`<br>
> ì„±ê³µì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸ ğŸ‘†

---

-7. `fabric-couchdb` ë¥¼ ì´ìš©í•˜ê³  ìˆì–´ì„œ **'ì›”ë“œìŠ¤í…Œì´íŠ¸'** ë¥¼ ë³¼ìˆ˜ìˆë‹¤

<http://localhost:5984/_utils>  
(ğŸ‘† ì›”ë“œìŠ¤í…Œì´íŠ¸ ë¡œì»¬í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ)

![](https://velog.velcdn.com/images/-__-/post/82d06595-ac2a-4ce8-944c-6cadb7f98afc/image.png)

> ğŸ‘† **'ì›”ë“œìŠ¤í…Œì´íŠ¸'** ë°ì´í„° ë² ì´ìŠ¤<br>
> 'ì´ë”ìŠ¤ìº”' , 'í´ë ˆì´ìŠ¤ì½”í”„' ì™€ ê°™ì´<br>
> íŠ¸ëœì­ì…˜ ë°œìƒ ë‚´ìš©ì„ UI ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤

![](https://velog.velcdn.com/images/-__-/post/b8ccb89c-006e-4dff-998a-ee048fdcbb7a/image.png)

> ğŸ‘† **'CAR12' Metadata**<br>
> ì²´ì¸ì½”ë“œë¡œ íŠ¸ëœì­ì…˜ì„ ë°œìƒì‹œí‚¨ ê°’ì´<br>
> key-value ë°ì´í„°ë¡œ ì˜ ë‹´ê¸´ê±¸ í™•ì¸ í•  ìˆ˜ ìˆë‹¤

![](https://velog.velcdn.com/images/-__-/post/9e902360-054c-4354-9ac1-ebcff4e7539b/image.png)

> ğŸ‘† **'CAR12' json**<br>
> ì²´ì¸ì½”ë“œë¡œ íŠ¸ëœì­ì…˜ì„ ë°œìƒì‹œí‚¨<br>
> `"CAR12","sm","sm3","red","shin"` ë°ì´í„°ê°€<br>
> JSON í˜•ì‹ìœ¼ë¡œ ì˜ ë‹´ê¸´ê±¸ í™•ì¸ í•  ìˆ˜ ìˆë‹¤

---
