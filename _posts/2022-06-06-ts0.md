---
layout: post
title: "[typescript] ë¦¬ì•¡íŠ¸ì™€ MetaMask ì—°ê²° êµ¬í˜„í•˜ê¸° (Web3.js)"
subtitle: web3.js / MetaMask / ABI / window.ethereum
categories: typescript
tags: [typescript]
---

![](https://velog.velcdn.com/images/-__-/post/b2bd7c08-e005-49d2-be4c-65c7a4351c5f/image.png)

React ê¸°ë°˜ì´ë¯€ë¡œ **ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ 'CRA'** ë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤

`npx create-react-app "ì´ë¦„" â€”template typescript`

web3ì„ ì„¤ì¹˜í•´ì¤€ë‹¤

`npm install web3`

---

### window.ethereum ì¸í„°í˜ì´ìŠ¤ (react-app-env.d.ts)

```js
/// <reference types="react-scripts" />

interface Window {
  ethereum: any;
}

// ğŸ‘‰ Windowë¼ëŠ” ê°ì²´ì— ë©”íƒ€ë§ˆìŠ¤í¬ë¥¼ ì„¤ì¹˜í•˜ë©´ ethereum: any ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ìƒê¸´ë‹¤
// ğŸ‘‰ ë¦¬ì•¡íŠ¸ì—ì„  ì´ê±¸ ì¸ì‹í•˜ì§€ ëª»í•¨
// ğŸ‘‰ ê·¸ë˜ì„œ ì´ëŸ°ì‹ìœ¼ë¡œ ê°•ì œë¡œ ì ì–´ì£¼ëŠ”ê²ƒì´ë‹¤
```

---

### web3.js ë¥¼ í†µí•´ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ìƒì„±í•˜ê¸° (index.ts)

- ê°œë°œìëŠ” <span style="background-color:#B5E045; color:#000;">'ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ'</span>ì™€ <span style="background-color:#B5E045; color:#000;">'ABI'</span>ë¥¼ ì•Œë©´ 'web3.js' ë¥¼ í†µí•´
- ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ìƒì„±í•˜ê³  / íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤

```js
import { AbiItem } from "web3-utils";
import Web3 from "web3";

// remix IDE ì—ì„œ ì»´íŒŒì¼ ë°‘ì— ABI ë¥¼ ë³µì‚¬í•´ì˜¨ë‹¤
const mintAnimalTokenAbi: AbiItem[] = [ABI ë¶™í˜€ë„£ê¸°];

const saleAnimalTokenAbi: AbiItem[] = [ABI ë¶™í˜€ë„£ê¸°];

// remix IDE ì—ì„œ ë©”íƒ€ë§ˆìŠ¤í¬ë¡œ ê°ê° ë°°í¬í•˜ê³  ë‚˜ì˜¨ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì˜¨ë‹¤
const mintAnimalTokenAddress = "0x9bADD7AB6c2d6929bf8483Db8aBD9D71EFd49E29";
const saleAnimalTokenAddress = "0x01F1A290D1954f770B4CeF170EBF1DeE474Ceb3F";

export const web3 = new Web3(window.ethereum);
// ë©”íƒ€ë§ˆìŠ¤í¬ê°€ ì„¤ì¹˜ë˜ì–´ìˆìœ¼ë©´ ë”°ë¡œ importí•˜ì§€ ì•Šì•„ë„ ì‘ë™í•˜ëŠ” ëª¨ë“ˆ (window.ethereum)

export const mintAnimalTokenContract = new web3.eth.Contract(
  // â­ ê°œë°œìëŠ” 'ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ'ì™€ 'ABI'ë¥¼ ì•Œë©´ 'web3.js' ë¥¼ í†µí•´
  // â­ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ìƒì„±í•˜ê³  / íŠ¹ì • í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤
  mintAnimalTokenAbi,
  mintAnimalTokenAddress
);

export const saleAnimalTokenContract = new web3.eth.Contract(
  saleAnimalTokenAbi,
  saleAnimalTokenAddress
);
```

---

### ë¦¬ì•¡íŠ¸ì™€ ë©”íƒ€ë§ˆìŠ¤í¬ ì§€ê°‘ ì—°ê²° (App.tsx)

```js
import React, { FC, useEffect, useState } from "react";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import Main from "./routes/main";

const App: FC = () => {
  const [account, setAccount] = useState < string > "";

  const getAccount = async () => {
    try {
      // try ë¬¸ ì•ˆì˜ ì½”ë“œê°€ ì­‰ ì‹¤í–‰ë˜ê³  ì—ëŸ¬ê°€ ì—†ë‹¤ë©´ catchëŠ” ê±´ë„ˆë›´ë‹¤
      if (window.ethereum) {
        // if ğŸ‘‰ ë©”íƒ€ë§ˆìŠ¤í¬ê°€ ì„¤ì¹˜ë˜ì–´ìˆìœ¼ë©´ ì‹¤í–‰ëœë‹¤
        const accounts = await window.ethereum.request({
          method: "eth_requestAccounts",
        }); // ì—°ê²°ëœ ë©”íƒ€ë§ˆìŠ¤í¬ì˜ ì£¼ì†Œê°€ ë‚˜ì˜¨ë‹¤
        // ğŸ‘‰ window.ethereum.request ì„ console.logì— ì°ì–´ë³´ë©´ í™•ì¸í• ìˆ˜ ìˆë‹¤

        setAccount(accounts[0]);
        // ì—°ê²°ëœ ë©”íƒ€ë§ˆìŠ¤í¬ì˜ ì£¼ì†Œë¥¼ useStateì— ë‹´ëŠ”ë‹¤
      } else {
        // ë©”íƒ€ë§ˆìŠ¤í¬ê°€ ì„¤ì¹˜ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ ğŸ‘‰ alert ë¬¸êµ¬ê°€ ë‚˜ì˜¨ë‹¤
        alert("Install Metamask!");
      }
    } catch (error) {
      // ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ catch ì‹¤í–‰
      console.error(error); // ğŸ‘‰ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ê³  ì¶œë ¥
    }
  };

  useEffect(() => {
    getAccount(); // getAccount í•œë²ˆë§Œ ì‹¤í–‰
  }, []);

  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Main />} />
      </Routes>
    </BrowserRouter>
  );
};

export default App;
```

---

### ë¦¬ì•¡íŠ¸ì™€ ë©”íƒ€ë§ˆìŠ¤í¬ ì§€ê°‘ ì—°ê²° êµ¬í˜„

`npm run start` ë¥¼ í•˜ë©´

![](https://velog.velcdn.com/images/-__-/post/34b76109-aa2f-4e2a-8b58-820c77641210/image.png)

> ğŸ‘† ë©”íƒ€ë§ˆìŠ¤í¬ ì§€ê°‘ê³¼ ì—°ê²°í•  ìˆ˜ ìˆëŠ” íŒì—…ì°½ì´ ë‚˜ì˜¤ê³  ì—°ê²°í•  ìˆ˜ ìˆë‹¤

---

### ì „ì²´ì½”ë“œ github

<https://github.com/wavescats/mini-project/tree/main/Dapp-NFT(MintAnimal)/front-end>

---

### ì°¸ê³  í–ˆë˜ ì‚¬ì´íŠ¸ ğŸ–¥

- <https://blog.valist.io/how-to-connect-web3-js-to-metamask-in-2020-fee2b2edf58a>

- <https://velog.io/@mjlee0326/React%EC%99%80-Web3%EC%9D%98-%EB%A7%8C%EB%82%A8>

---
